webpackJsonp([9],{"7GnN":function(t,e){},P3lM:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=s("Gu7T"),i=s.n(a),n=s("Xxa5"),r=s.n(n),l=s("exGp"),o=s.n(l),c=s("zvae"),d=s("kD8Z"),u={props:["validateNewsList"],data:function(){return{validateNewsTips:d.n,IMG_URL:"http://47.106.175.18:9000/",filterType:0,filterStatus:0,isAdding:!1}},computed:{outcomteList:function(){var t=this;return this.validateNewsList.filter(function(e){return-1===t.filterStatus?e.validateType===t.filterType:e.status===t.filterStatus&&e.validateType===t.filterType})},systemValidateUsers:function(){return this.$store.state.app.sysUsers.filter(function(t){return"111111"===t.code})[0]},userInfo:function(){return this.$store.state.user.userInfo},device:function(){return this.$store.state.device.deviceType}},methods:{agreeValidate:function(t){var e=this;0===t.validateType?this.$socket.emit("sendAgreeFriendValidate",t):1===t.validateType&&this.$socket.emit("sendAgreeGroupValidate",t),this.$store.dispatch("app/SET_AGREE_FRIEND_VALIDATE",!0),this.isAdding=!0,setTimeout(function(){e.isAdding=!1,e.$emit("changeValidateNewsStatus",t,1),e.$alert("添加成功","提示！",{confirmButtonText:"确定"})},500)}},mounted:function(){this.$store.dispatch("news/SET_UNREAD_NEWS",{roomid:this.systemValidateUsers._id+"-"+this.userInfo._id,count:0,type:c.a.clear})}},v={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"validatenews-com"},[s("div",{staticClass:"wrapper"},[s("div",{staticClass:"title"},[t._v("验证消息")]),t._v(" "),s("div",{staticClass:"filter"},[s("el-tag",{attrs:{type:"info"}},[t._v("选择过滤条件：")]),t._v(" "),s("el-select",{attrs:{placeholder:"请选择"},model:{value:t.filterType,callback:function(e){t.filterType=e},expression:"filterType"}},[s("el-option",{attrs:{label:"群",value:1}}),t._v(" "),s("el-option",{attrs:{label:"好友",value:0}})],1),t._v(" "),s("el-select",{attrs:{placeholder:"请选择"},model:{value:t.filterStatus,callback:function(e){t.filterStatus=e},expression:"filterStatus"}},[s("el-option",{attrs:{label:"全部",value:-1}}),t._v(" "),s("el-option",{attrs:{label:"未处理",value:0}}),t._v(" "),s("el-option",{attrs:{label:"已同意",value:1}}),t._v(" "),s("el-option",{attrs:{label:"已拒绝",value:2}})],1)],1),t._v(" "),s("div",{staticClass:"counter"},[s("span",[t._v("\n        一共"+t._s(t.outcomteList.length)+"条记录\n      ")])]),t._v(" "),t._l(t.outcomteList,function(e){return s("div",{key:e.time,staticClass:"validatenews-item"},[s("div",{staticClass:"apply-info"},[s("span",{staticClass:"title"},[s("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"点击查看用户主页",placement:"top"}},[s("span",{staticClass:"nickname"},[s("router-link",{attrs:{to:"/user/"+e.senderId}},[t._v("\n                "+t._s(e.senderNickname.slice(0,10))+"\n              ")])],1)]),t._v(" "),0===e.validateType?s("span",[t._v("\n            "+t._s(t.validateNewsTips.applyFriend)+"\n          ")]):1===e.validateType?s("span",[t._v("\n            "+t._s(t.validateNewsTips.applyGroup)+"："+t._s(e.groupId&&e.groupId.title)+"\n          ")]):t._e(),t._v(" "),s("span",{staticClass:"time"},[t._v("\n            "+t._s(e.time)+"\n          ")])],1)]),t._v(" "),s("div",{staticClass:"go-operation"},[s("el-popover",{attrs:{placement:"left",width:"300",trigger:"click"}},[s("div",{directives:[{name:"loading",rawName:"v-loading",value:t.isAdding,expression:"isAdding"}],staticClass:"validate-popover-body"},[s("div",{staticClass:"sender-info"},[s("el-avatar",{attrs:{size:60,src:t.IMG_URL+e.senderAvatar},on:{error:function(){return!0}}},[s("img",{attrs:{src:"https://cube.elemecdn.com/e/fd/0fc7d20532fdaf769a25683617711png.png"}})]),t._v(" "),s("div",{staticClass:"info"},[s("span",{staticClass:"nickname"},[t._v(t._s(e.senderNickname))])])],1),t._v(" "),s("div",{staticClass:"addition"},[s("el-tag",{attrs:{size:"mini",type:"info"}},[t._v("附加消息：")]),t._v(" "),s("div",{staticClass:"content"},[s("span",[t._v(t._s(e.additionMessage))])])],1),t._v(" "),0===e.status?s("div",{staticClass:"operation"},[s("el-button",{attrs:{type:"success",plain:"",size:"small"},on:{click:function(s){t.agreeValidate(e)}}},[t._v("同意")]),t._v(" "),s("el-button",{attrs:{type:"danger",plain:"",size:"small"}},[t._v("拒绝")])],1):1===e.status?s("div",{staticClass:"operation"},[s("el-tag",{attrs:{type:"success"}},[t._v("已同意")])],1):2===e.status?s("div",{staticClass:"operation"},[s("el-tag",{attrs:{type:"danger"}},[t._v("已拒绝")])],1):t._e()]),t._v(" "),s("el-button",{attrs:{slot:"reference",type:"success"},slot:"reference"},[t._v("查看")])],1)],1)])})],2)])},staticRenderFns:[]};var p={name:"System",data:function(){return{validateNewsList:[]}},computed:{userInfo:function(){return this.$store.state.user.userInfo},device:function(){return this.$store.state.device.deviceType}},methods:{fetchMyValidateNews:function(){var t=this;return o()(r.a.mark(function e(){var s,a,i,n,l;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return s=t.userInfo._id,e.next=3,t.$http.getMyValidateNews({id:s});case 3:a=e.sent,i=a.data,n=i.data,l=i.status,console.log(i),2e3===l&&(t.validateNewsList=n);case 8:case"end":return e.stop()}},e,t)}))()},changeValidateNewsStatus:function(t,e){console.log(t,e);var s=t.roomid,a=t.senderId,i=t.reveiverId;this.validateNewsList.forEach(function(t){t.roomid===s&&t.senderId===a&&t.reveiverId===i&&(t.status=e)})}},components:{validateNews:s("VU/8")(u,v,!1,function(t){s("scc7")},null,null).exports},sockets:{receiveValidateMessage:function(t){console.log("在system页面接收新的验证消息：",t),this.validateNewsList=[].concat(i()(this.validateNewsList),[t])}},created:function(){this.fetchMyValidateNews()}},f={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"system-page",style:"Mobile"===this.device?{width:"100%"}:{}},[e("p",{staticClass:"title"},[this._v("我的系统消息")]),this._v(" "),e("validate-news",{attrs:{validateNewsList:this.validateNewsList},on:{changeValidateNewsStatus:this.changeValidateNewsStatus}})],1)},staticRenderFns:[]};var _=s("VU/8")(p,f,!1,function(t){s("7GnN")},null,null);e.default=_.exports},scc7:function(t,e){}});
//# sourceMappingURL=9.2c6017b0584ca45244a5.js.map